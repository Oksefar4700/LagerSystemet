<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8"/>
  <title>Visitor Dashboard</title>
  <meta http-equiv="Content-Language" content="da,en">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <link rel="stylesheet" type="text/css" href="/static/css/database.css">
</head>
<body>
<div class="sprog">
  <a href="?lang=en">English</a> | <a href="?lang=da">Dansk</a>
</div>
<div>
  <div class="navbox">
    <ul class="nav">
      <li><a href="/administrator/dashboard">Back to Home</a></li>
      <li><a href="/administrator/view-database">Back to Database View</a></li>
    </ul>
  </div>
  <div class="tabeltext">
    <h1>Visitor Dashboard</h1>
    <h2>Visitors</h2>
  </div>
  <form id="searchForm">
    <input type="text" id="keywordInput" name="keyword" placeholder="Search by name">
    <button type="submit">Search</button>
  </form>

  <table>
    <tr>
      <th>Visitor ID</th>
      <th>First Name</th>
      <th>Last Name</th>
      <th>License Passport Nr</th>
      <th>Location</th>
      <th>Picture ID</th>
      <th>Cause For Visit</th>
      <th>Visits</th>
      <th>Action</th>
    </tr>
    <tr th:each="visitor : ${visitors}">
      <td th:text="${visitor.personId}"></td>
      <td th:text="${visitor.firstName}"></td>
      <td th:text="${visitor.lastName}"></td>
      <td th:text="${visitor.licencePassportNr}"></td>
      <td th:text="${visitor.location}"></td>
      <td th:text="${visitor.pictureUrl}"></td>
      <td th:text="${visitor.causeForVisit}"></td>
      <td>
        <ul>
          <li th:each="visit : ${visitor.visitsList}" th:text="${visit.check_in_time}"></li>
        </ul>
      </td>
      <td><a th:href="@{/admin/edit-visitor/(id=${visitor.personId})}" th:text="Edit">Edit</a></td>
    </tr>
  </table>

  <script>
    $(document).ready(function() {
      $('#searchForm').on('submit', function(e) {
        e.preventDefault(); // Prevent default form submission behavior

        var formData = $(this).serialize(); // Get form data

        $.ajax({
          type: 'GET',
          url: '/administrator/visitor-database',
          data: formData,
          success: function(response) {
            $('#visitorTableContainer').html(response); // Update the table container with the search results
          },
          error: function(xhr, status, error) {
            console.error(error); // Handle any errors
          }
        });
      });
    });
  </script>
</div>
</body>
</html>
